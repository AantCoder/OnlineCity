На сервере существует API по которому можно отправлять запросы по протоколу HTTP POST в JSON формате с кодировкой UTF-8.

Запросы посылаются на тот же порт, куда происходит и игровое подключение. После открытия TCP соединения следует посылать POST с JSON запросом в кодировке UTF-8, либо POST с enctype="multipart/form-data". Допускается только один запрос на подключение, после отправки ответа соединение закрывается.

Пример запроса:
```
{Q:"PlayerStat"}
```
Ответ:
```
{"OnlineCount":1, "PlayerCount":674, "Onlines":["TheCrazeMan"]}
```

Все актуальные команды запроса смотри в файле OnlineCityAPIModel.cs. Этот файл вместе с OnlineCityAPIClient.cs можно использовать для запросов. Пример его использования на C#:
```
var api = new OnlineCityAPIClient("127.0.0.1", 19019);
string response = null;

api.Request("{Q:\"s\"}", (res) => { response = res; });
Thread.Sleep(5000);

api.RequestStatus((res) => { response = $"Online {res.OnlineCount}/{res.PlayerCount}"; });
Thread.Sleep(5000);

api.RequestPlayer("TheCrazeMan", (res) => { response = res.Players[0].Login; });
Thread.Sleep(5000);
```

Для быстрой проверки можно воспользоваться консольной командой telnet. Для этого запустите telnet (убедитесь, что он есть у вас иначе найдите в интернете, как активировать его).
После этого скопируйте в буфер следующий текст
```
o 127.0.0.1 19019
POST / HTTP/1.1

{Q:"s"}
```
Перейдите к окну telnet и вставьте команду нажатием Ctrl+v. Типичный ответ может быть таким:
```


       HTTP/1.0 200 OK
Content-Type: application/json; charset=utf-8
Connection: close

{"OnlineCount":0,"PlayerCount":2,"Onlines":[]}
```

Для примера POST с enctype="multipart/form-data" создайте html-файл с содержимым:
<html>
<body>
<form action="http:\\127.0.0.1:19019" method="post" target="_blank" enctype="multipart/form-data">
 Q:<input name="Q" type="text" placeholder="test" autofocus><br>
 Key:<input name="Key" type="text"><br>
 image:<input type="file" name="data" multiple="true" accept="image/png, image/jpeg"><br>
 <input type="submit"><br>
</form>
</body>
</html>

Откройте в браузере и укажите в форме нужные значения.


Некоторые интересные вещи после одновления 0.4.80 (полные возможности смотри в OnlineCityAPIModel.cs):

В обновлении API теперь можно добавлять и загружать изображения. Но их нужно запрашивать не в json формате, а в multipart/form-data как через веб форму. Есть пример Documentation\test.html где через браузер можно скачать и залить.
Для сохранения и загрузки изображений нужно указать специальное имя в поле N. Варианты:
1. Если оно начинасется с pl_, дальше идет ник игрока, то это указывает на аватарку игрока.
2. В N указать cs_, после ник игрока, символ "@" и serverId колонии скрин которой нужен (serverId можно получить из запроса Q:"a" или Q:"p" в поле BaseServerIds).

Для некоторых запросов нужно указывать ключ в параметре Key. Он должен быть равен указанному в настройках серверу SecretKey.

Функции которые вызываються нажатием клавиши в консоле можно вызвать через API командой "cc". Указать символ в N и ключ в Key.

Можно отправить текст в чат игры аналогично команде консоли C с фалом command.txt. Для этого выполнить команду "cp" и указать текст в N и ключ в Key.

Командой "BlockKey" (и ключ в Key) можно запросить содержимое файла blockkey.txt

Командой "PlayerStat" (и ключ в Key) можно запросить отчет обо всех игроках, который можно получить нажав в консоле сервера S

Для включения требования подтверждения авторизации игроков нужно включить в настройках сервера PlayerNeedApprove и PlayerNeedApproveInDiscord (пока что подтверждение только через дискорд).
После регистрации логин игрока будет приходить в ответе на запрос статистики с указанным ключом ({Q:"s",Key:"..."}) в параметре NeedApprove передаются строки, где указан ник игрока*имя в дискорде. Это игроки которые зарегистрировались и их нужно подтвержить в дискорде. Для подтверждения отправьте запрос PlayerApprove или pa, ключ, и в поле Login перечислить логины подтвержденных игроков через *, а в поле N перечислить логины которым отказано, для их удаления (после этого эти логины освободятся для повторной регистрации).
